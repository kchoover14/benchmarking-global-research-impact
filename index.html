<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kara C. Hoover">

<title>Benchmarking Research Impact Across Countries and Fields at Scale</title>
<style>
/* Default styles provided by pandoc.
** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
*/
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="benchmarking-global-research-impact_files/libs/clipboard/clipboard.min.js"></script>
<script src="benchmarking-global-research-impact_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="benchmarking-global-research-impact_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="benchmarking-global-research-impact_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="benchmarking-global-research-impact_files/libs/quarto-html/popper.min.js"></script>
<script src="benchmarking-global-research-impact_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="benchmarking-global-research-impact_files/libs/quarto-html/anchor.min.js"></script>
<link href="benchmarking-global-research-impact_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="benchmarking-global-research-impact_files/libs/quarto-html/quarto-syntax-highlighting-076ecbd647e1f0418c5051713cd9b730.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="benchmarking-global-research-impact_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="benchmarking-global-research-impact_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="benchmarking-global-research-impact_files/libs/bootstrap/bootstrap-ac1b6c3b0919515520eeab2ecf0c4950.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="blues quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#research-questions" id="toc-research-questions" class="nav-link" data-scroll-target="#research-questions">Research Questions</a></li>
  <li><a href="#research-answers" id="toc-research-answers" class="nav-link" data-scroll-target="#research-answers">Research Answers</a>
  <ul class="collapse">
  <li><a href="#impact-weighted-research-output" id="toc-impact-weighted-research-output" class="nav-link" data-scroll-target="#impact-weighted-research-output">Impact-Weighted Research Output</a></li>
  <li><a href="#collaboration-networks" id="toc-collaboration-networks" class="nav-link" data-scroll-target="#collaboration-networks">Collaboration Networks</a></li>
  <li><a href="#research-impact-by-field" id="toc-research-impact-by-field" class="nav-link" data-scroll-target="#research-impact-by-field">Research Impact by Field</a></li>
  </ul></li>
  <li><a href="#study-design" id="toc-study-design" class="nav-link" data-scroll-target="#study-design">Study Design</a></li>
  <li><a href="#data-code" id="toc-data-code" class="nav-link" data-scroll-target="#data-code">Data &amp; Code</a></li>
  <li><a href="#tools-technologies" id="toc-tools-technologies" class="nav-link" data-scroll-target="#tools-technologies">Tools &amp; Technologies</a></li>
  <li><a href="#expertise" id="toc-expertise" class="nav-link" data-scroll-target="#expertise">Expertise</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Benchmarking Research Impact Across Countries and Fields at Scale</h1>
  <div class="quarto-categories">
    <div class="quarto-category">bibliometrics</div>
    <div class="quarto-category">scientometrics</div>
    <div class="quarto-category">network analysis</div>
    <div class="quarto-category">geospatial visualization</div>
    <div class="quarto-category">Google BigQuery</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kara C. Hoover </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="executive-summary" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary">Executive Summary</h2>
<p><strong>Problem:</strong> Standard bibliometric measures – raw citation counts and average Field Citation Ratios – are poorly suited for cross-country comparison. Citation counts ignore field norms while average FCR is skewed by outliers and collapses across vastly different publication volumes. Without field-sensitive measures, research landscape assessments produce a distorted picture – funders miss high-impact targets, institutions fail to recognize their own relative strengths, and potential partners go unidentified because volume-based rankings bury the contributors that matter most.</p>
<p><strong>Approach:</strong> Using publication metadata from the Dimensions COVID-19 dataset via Google BigQuery, I developed a novel Impact-Weighted Research Output metric that iteratively tested and validated four candidate measures before selecting one optimized for cross-country stability. The metric balances field-normalized citation impact with log-transformed publication volume, then was applied to three analyses: country-level benchmarking, international collaboration network mapping, and field-level impact comparison.</p>
<p><strong>Insights:</strong> High publication volume and high research impact do not correlate predictably – the countries and fields that publish most are not necessarily those generating the most influential work. Closing that gap requires metrics that account for both field norms and output scale simultaneously, moving beyond single-dimension measures toward composite frameworks that reflect how influence actually distributes. Network centrality reveals a complementary dimension that output metrics miss entirely, distinguishing connectors from producers. Both findings depend critically on how fields are classified – the system used to categorize research shapes which contributions are visible and which are structurally obscured, making classification quality inseparable from the validity of any landscape assessment.</p>
<p><strong>Significance:</strong> Research landscape assessments – whether for funding allocation, partnership development, or institutional benchmarking – rest on the metrics used to build them. Standard measures systematically favor high-volume producers and render high-impact low-volume contributors invisible. Classification systems compound this problem by fragmenting disciplines unevenly, making some fields effectively unmeasurable. Metric quality is not a methodological footnote – it determines whose contributions count.</p>
<p><strong>Key Findings</strong></p>
<ul>
<li>The US leads in raw publication volume (327,428) but China edges it on the composite metric, reflecting a higher average FCR (7.27 vs.&nbsp;6.37)</li>
<li>US and UK betweenness centrality (0.09 and 0.07 vs.&nbsp;network mean 0.006) identifies them as structural brokers – connectors across otherwise disconnected research communities, not just prolific producers</li>
<li>No field achieved both high volume and high impact; Math and Physical Sciences and Philosophy and Religious Studies had the highest FCR despite modest output</li>
<li>Social Sciences impact cannot be reliably assessed in this dataset – FOR classification codes fragment the field across subcategories, making it effectively invisible as a coherent unit</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>This project applies custom metric design and network science to large-scale public research metadata to produce country- and field-level intelligence not available from standard bibliometric tools – supporting research landscape assessment for funders, partnership builders, and institutional strategists.</p>
</div>
</div>
</div>
<hr>
</section>
<section id="research-questions" class="level2">
<h2 class="anchored" data-anchor-id="research-questions">Research Questions</h2>
<ol type="1">
<li>Which countries produce the highest-impact research when both citation quality and publication volume are accounted for?</li>
<li>Which countries serve as central hubs in the international research collaboration network?</li>
<li>How does research impact vary across disciplines, and where are the gaps between volume and influence?</li>
</ol>
<hr>
</section>
<section id="research-answers" class="level2">
<h2 class="anchored" data-anchor-id="research-answers">Research Answers</h2>
<section id="impact-weighted-research-output" class="level3">
<h3 class="anchored" data-anchor-id="impact-weighted-research-output">Impact-Weighted Research Output</h3>
<p>The custom metric – normalized, field-corrected, volume-weighted FCR – outperformed three alternatives on all distributional properties. The key contrast:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Metric</th>
<th>Mean</th>
<th>Std Dev</th>
<th>Max</th>
<th>Variance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Citation Rate</td>
<td>11.98</td>
<td>6.83</td>
<td>68.50</td>
<td>46.66</td>
</tr>
<tr class="even">
<td>Average FCR</td>
<td>4.63</td>
<td>1.21</td>
<td>6.33</td>
<td>1.47</td>
</tr>
<tr class="odd">
<td>Research Efficiency</td>
<td>0.92</td>
<td>4.37</td>
<td>190.20</td>
<td>19.08</td>
</tr>
<tr class="even">
<td><strong>Impact-Weighted Research Output</strong></td>
<td><strong>0.007</strong></td>
<td><strong>0.010</strong></td>
<td><strong>1.00</strong></td>
<td><strong>0.0001</strong></td>
</tr>
</tbody>
</table>
<p>The impact-weighted metric operates across n=68,166 field-country observations, compared to 235 for Citation Rate and just 23 for Average FCR. Its variance (0.0001) is roughly 470,000x lower than Citation Rate variance (46.66), making it far more stable for cross-country comparison. After applying a minimum publication threshold of 10 to remove small-country outliers, the top five countries were China (0.36), UK (0.33), US (0.33), Australia (0.31), and Netherlands (0.28).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="map-static-benchmarkMetric.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1. Global distribution of the Impact-Weighted Research Output metric. Darker blue indicates higher normalized weighted FCR.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plot-benchmarkComparison.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2. Top 5 countries by Impact-Weighted Research Output with standard deviation error bars. The dashed green line marks the global mean.</figcaption>
</figure>
</div>
<p><strong>Interpretation:</strong> The metric surfaces a distinction raw counts obscure: the US publishes more, but China and the UK generate comparable or higher field-normalized impact per unit of output. Simple citation counts and average FCR both fail in large-scale cross-country comparisons – the former ignores field norms, the latter is skewed by outliers. The iterative process of testing and refining four candidate metrics before selecting one illustrates the importance of metric validation, not just metric selection.</p>
</section>
<section id="collaboration-networks" class="level3">
<h3 class="anchored" data-anchor-id="collaboration-networks">Collaboration Networks</h3>
<p>The US and UK dominate all three centrality measures by a wide margin. US degree centrality (0.98) and closeness centrality (0.98) are nearly at the theoretical maximum of 1.0, compared to a network mean of 0.28 and 0.59 respectively. China, India, and Canada cluster in a second tier (degree: 0.76–0.80), well above the mean but clearly separated from the US/UK.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Country</th>
<th>Degree</th>
<th>Betweenness</th>
<th>Closeness</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Network Mean</td>
<td>0.28</td>
<td>0.006</td>
<td>0.59</td>
</tr>
<tr class="even">
<td>United States</td>
<td>0.98</td>
<td>0.092</td>
<td>0.98</td>
</tr>
<tr class="odd">
<td>United Kingdom</td>
<td>0.94</td>
<td>0.074</td>
<td>0.95</td>
</tr>
<tr class="even">
<td>China</td>
<td>0.80</td>
<td>0.033</td>
<td>0.83</td>
</tr>
<tr class="odd">
<td>India</td>
<td>0.79</td>
<td>0.034</td>
<td>0.83</td>
</tr>
<tr class="even">
<td>Canada</td>
<td>0.76</td>
<td>0.028</td>
<td>0.81</td>
</tr>
</tbody>
</table>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="map-static-network.png" class="img-fluid figure-img"></p>
<figcaption>Figure 3. Global research collaboration network. Node size proportional to degree centrality; edge thickness reflects collaboration strength.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plot-networkComparison.png" class="img-fluid figure-img"></p>
<figcaption>Figure 4. Centrality measures for the top 5 countries compared to the network mean. The US and UK lead across all three measures by a wide margin.</figcaption>
</figure>
</div>
<p><strong>Interpretation:</strong> The US and UK are not just prolific – they are structurally irreplaceable. Their betweenness centrality means they broker connections across otherwise disconnected research communities. Countries like India and Canada have substantial publication counts but lower centrality scores – a meaningful distinction for landscape assessment: central network nodes are connectors, not just producers. High eigenvector centrality reflects integration into high-influence clusters, not just raw connectivity.</p>
</section>
<section id="research-impact-by-field" class="level3">
<h3 class="anchored" data-anchor-id="research-impact-by-field">Research Impact by Field</h3>
<p>No field achieved both high publication volume and high impact simultaneously. The highest-FCR fields globally were Math and Physical Sciences (FCR: 5.74, n=10,585), Philosophy and Religious Studies (FCR: 5.38, n=20,050), and Economics (FCR: 5.18, n=34,184). Biomedical and Clinical Sciences had by far the largest volume (470,377 publications) but a mid-range FCR (4.78). The US consistently matched or exceeded global benchmarks across fields.</p>
<p><strong>Interpretation:</strong> The high Math and Physical Sciences FCR reflects computational epidemiology and modeling work that attracted outsized citation attention. The apparent Social Sciences and Biology gap – high relevance to the research domain, lower citation return – warrants caution before drawing any conclusions. Dimensions field classifications are based on Australian/New Zealand FOR codes, which are not globally standardized. Social Sciences is fragmented across subcategories in this system, with disciplines like Psychology classified under different main fields entirely. The category as it appears in this dataset is not a reliable proxy for the global Social Sciences research contribution. Biology faces a similar fragmentation issue. A more accurate field-level analysis would require remapping to a globally consistent classification system such as Web of Science subject categories or Scopus ASJC codes.</p>
<hr>
</section>
</section>
<section id="study-design" class="level2">
<h2 class="anchored" data-anchor-id="study-design">Study Design</h2>
<p><strong>Data Source:</strong> Dimensions COVID-19 publications dataset accessed via Google BigQuery – a large-scale public research metadata repository used here as the analytical substrate. Metadata includes author affiliations, field classifications, Field Citation Ratio (FCR), and publication counts.</p>
<p><strong>Data Handling:</strong> Publications with non-null FCR values retained; field classifications use Dimensions Australian/New Zealand FOR codes – Social Sciences and related disciplines are fragmented across subcategories and should be interpreted with caution in field-level comparisons; single-author and single-country publications excluded from network analysis; top 1% of publications per field retained for collaboration network construction; countries with fewer than 10 publications filtered from country benchmarking to remove small-sample outliers (e.g., Nauru: 3 publications, inflated metric of 0.31).</p>
<p><strong>Analytical Approach:</strong></p>
<ol type="1">
<li>Metric Development – iterative construction and validation of a composite impact metric against three alternatives; distributional diagnostics used to select final metric</li>
<li>Country Benchmarking – global and country-level aggregation of the impact metric, choropleth mapping, top-5 comparison against global mean</li>
<li>Network Analysis – co-authorship network construction, degree/betweenness/closeness centrality, top-10 hub identification</li>
<li>Field Analysis – FCR vs.&nbsp;publication count by research field, US vs.&nbsp;global comparison</li>
</ol>
<p><strong>Metric construction:</strong></p>
<ul>
<li>Field-level FCR normalization: each FCR value divided by the mean FCR of its research field to remove cross-field citation practice bias</li>
<li>Log-transformation of publication count: <code>log1p()</code> applied to reduce skew from large-country outliers</li>
<li>Weighted FCR: normalized FCR x log-transformed publication count</li>
<li>Final normalization: weighted FCR divided by its maximum value, producing a 0–1 scale</li>
</ul>
<hr>
</section>
<section id="data-code" class="level2">
<h2 class="anchored" data-anchor-id="data-code">Data &amp; Code</h2>
<p><strong>Public dataset:</strong> <code>covid-19-dimensions-ai.data.publications</code> – freely accessible via Google BigQuery sandbox</p>
<p><strong>Repository:</strong> <a href="https://github.com/kchoover14/Bibliometrics-COVID19-Research">github.com/kchoover14/Bibliometrics-COVID19-Research</a></p>
<p><strong>Available:</strong></p>
<ul>
<li>GBQ SQL scripts</li>
<li>Processed CSV tables (exported from GBQ)</li>
<li>Figures (exported from GBQ/Python)</li>
<li>Rendered HTML output</li>
</ul>
<hr>
</section>
<section id="tools-technologies" class="level2">
<h2 class="anchored" data-anchor-id="tools-technologies">Tools &amp; Technologies</h2>
<ul>
<li><strong>Languages:</strong> Python | SQL</li>
<li><strong>Tools:</strong> Google BigQuery | Jupyter</li>
<li><strong>Packages:</strong> <code>google-cloud-bigquery</code>, <code>pandas</code>, <code>numpy</code>, <code>plotly</code>, <code>networkx</code>, <code>pandas-gbq</code>, <code>bigframes</code></li>
</ul>
<hr>
</section>
<section id="expertise" class="level2">
<h2 class="anchored" data-anchor-id="expertise">Expertise</h2>
<p><strong>Domain Expertise:</strong> bibliometrics | scientometrics | network analysis | research design | metric validation | technical writing</p>
<p><strong>Transferable Expertise:</strong> Designing evidence-based frameworks for strategic decision-making at scale; translating complex research landscapes into actionable intelligence for funders, institutional leaders, and partnership strategists; building reproducible analytical pipelines that produce outputs non-technical stakeholders can act on.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>